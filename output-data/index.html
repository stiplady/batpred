<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Output data - Predbat Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Output data";
        var mkdocs_page_input_path = "output-data.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Predbat Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Introduction</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../what-does-predbat-do/">What does Predbat do?</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Installing & configuring Predbat</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../installation-summary/">Install summary</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../install/">Install details</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../inverter-setup/">Inverter Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../energy-rates/">Energy rates</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../apps-yaml/">apps.yaml settings</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../car-charging/">Car charging</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../configuration-guide/">Configuration guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../customisation/">Customisation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../video-guides/">Video Guides</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../faq/">FAQ</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../devices/">Support 3rd party devices/integrations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../manual-api/">Predbat automation API</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Viewing Predbat data</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Output data</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#web-interface">Web interface</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#displaying-output-data">Displaying output data</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#creating-a-simple-predbat-dashboard">Creating a simple Predbat dashboard</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#creating-a-compact-predbat-control-dashboard">Creating a compact Predbat control dashboard</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#viewing-the-predbat-plan">Viewing the Predbat plan</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#graphing-the-predbat-predictions">Graphing the Predbat predictions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#basic-status">Basic status</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#baseline-data">Baseline data</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#pv-10-baseline-data">PV 10% baseline data</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#best">Best</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#best-pv-10">Best PV 10%</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#battery-status">Battery status</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#energy-rate-data">Energy rate data</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#low-import-rate-entities">Low import rate entities</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#high-export-rate-entities">High export rate entities</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#other-rate-entities">Other rate entities</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#car-data">Car data</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#iboost-solar-diverter-data">iBoost Solar Diverter data</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#energy-saving-data">Energy saving data</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#solar-forecast-data">Solar forecast data</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#predbat-logfile">Predbat Logfile</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#automated-monitoring-that-predbat-and-givtcp-are-running-ok">Automated monitoring that Predbat and GivTCP are running OK</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#givtcp-activity-monitor">GivTCP activity monitor</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#predbat-error-monitor">Predbat error monitor</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../predbat-plan-card/">Predbat Plan card</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../creating-charts/">Creating the charts</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Predbat development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../todo-list/">To-do list</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../developing/">Developing on Predbat</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Predheat</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../predheat/">predheat</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Predbat Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Viewing Predbat data</li>
      <li class="breadcrumb-item active">Output data</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="output-data">Output data</h1>
<p>Each time Predbat runs it outputs a lot of information about the current performance of your solar/battery system and the predicted load, PV, cost, CO2, car charging, etc.</p>
<p>This section of the documentation explains the different output and logging data that Predbat produces and gives an overview of how to display that information within Home Assistant.
There can never be a single Predbat dashboard that suits every user, so instead Predbat gives a starter-set of displays that can be adapted to your individual needs.</p>
<h2 id="web-interface">Web interface</h2>
<p><strong>NOTE:</strong> The Predbat web interface will not work with the AppDaemon or the Predbat-appdaemon installation methods.</p>
<p>Predbat has a Web interface active can be opened via the Predbat Add on by clicking on 'Web UI'. The web interface can be added to your sidebar by turning on the 'Show in Sidebar' toggle.</p>
<p>If you are not using the Predbat Add on then you may be able to access the Web Interface directly on port 5052 (e.g. with a Docker Container or Native on your Linux/MAC).</p>
<p>The Web interface can allow you to view the current plan, adjust the configuration, view the charts, check your apps.yaml and view the logfiles. You can change your view using
the top menu bar.</p>
<p><img alt="image" src="https://github.com/user-attachments/assets/fdad3d4a-91f3-4e66-bb02-2ac649cb8854" /></p>
<h2 id="displaying-output-data">Displaying output data</h2>
<p>Each Predbat configuration item is named <em>input_number.predbat_xxx</em>, <em>switch.predbat_yyy</em> or <em>select.predbat_zzz</em> depending on the control type.</p>
<h3 id="creating-a-simple-predbat-dashboard">Creating a simple Predbat dashboard</h3>
<p>Each time Predbat runs it auto-generates a dashboard with the filename <strong>predbat_dashboard.yaml</strong> that can be used as a starter for your own Predbat dashboard.
Depending on how you installed Predbat this predbat_dashboard.yaml file will be held in one of three different directories in Home Assistant:</p>
<ul>
<li>
<p>if you have used the <a href="../install/#predbat-add-on-install">Predbat add-on installation method</a>, it will be in the directory <code>/addon_configs/6adb4f0d_predbat/</code>,</p>
</li>
<li>
<p>if the <a href="../install/#appdaemon-predbat-combined-install">combined AppDaemon/Predbat add-on installation method</a> was used, it's in <code>/addon_configs/46f69597_appdaemon-predbat/</code>,
or</p>
</li>
<li>
<p>with the <a href="../install/#predbat-installation-into-appdaemon">HACS, Appdaemon add-on then Predbat installation method</a>, it's <code>/config/appdaemon/apps/batpred/config/</code>.</p>
</li>
</ul>
<p>You will need to use a file editor within Home Assistant (e.g. either the File editor or Studio Code Server add-on's) to open
the predbat_dashboard.yaml file - see <a href="../install/#editing-configuration-files-in-home-assistant">editing configuration files within Home Assistant</a> if you need to install an editor.</p>
<p>Once opened, select and copy all the contents of the predbat_dashboard.yaml file and add the contents into a new dashboard page:</p>
<ul>
<li>
<p>Go to System/Dashboards, click 'Open' against an existing dashboard or 'Add Dashboard'/'New dashboard from scratch'/enter a name/click Create, then click 'Open'</p>
</li>
<li>
<p>Click the pencil icon in the top right corner, click the blue 'Add card', scroll down the list of cards to the bottom and click 'Manual',
delete the template card configuration and paste the contents of the predbat_dashboard.yaml file copied earlier, then 'Save'.</p>
</li>
</ul>
<p>This will give you a simple Predbat control and output dashboard that you can then resequence and customise as you wish.</p>
<p><img alt="image" src="../images/output_data_dashboard_sample.png" /></p>
<h3 id="creating-a-compact-predbat-control-dashboard">Creating a compact Predbat control dashboard</h3>
<p>You can also create a dashboard page that's dynamically generated to automatically include all the Predbat control and output entities,
so when new entities are added in future Predbat releases, you don't have to edit the dashboard.</p>
<p>Firstly you need to <a href="../install/#hacs-install">install HACS</a> if it isn't already installed, and then install two HACS front end components:</p>
<ul>
<li>Auto Entities (<a href="https://github.com/thomasloven/lovelace-auto-entities">https://github.com/thomasloven/lovelace-auto-entities</a>)
automatically generates a list of entities that match a wildcard expression</li>
<li>Lovelace Collapsable Cards (<a href="https://github.com/RossMcMillan92/lovelace-collapsable-cards">https://github.com/RossMcMillan92/lovelace-collapsable-cards</a>)
wraps the entity lists within a drop-down toggle</li>
</ul>
<p>Installation steps:</p>
<ul>
<li>Click the HACS icon on the left-hand side panel</li>
<li>Click 'Frontend'</li>
<li>Click the three dots in the top right corner then 'Custom Repositories'</li>
<li>Paste (or type) in the following repository name <code>https://github.com/RossMcMillan92/lovelace-collapsable-cards</code>, choose Category of 'Lovelace', and click Add</li>
<li>Close the Custom repositories dialogue</li>
<li>Click 'Explore &amp; Download Repositories'</li>
<li>Search for 'collapsable cards', click the name of it, check it's the right one, click 'Download', 'Download' again, then 'Reload'</li>
<li>Click 'Explore &amp; Download Repositories' again, search for 'auto-entities', then 'Download', 'Download', 'Reload'</li>
</ul>
<p>Now create the dynamic dashboard:</p>
<ul>
<li>Go to Settings/Dashboards, click 'Open' against an existing dashboard or 'Add Dashboard'/'New dashboard from scratch'/enter a name/click Create, then click 'Open'</li>
<li>Click the pencil icon in the top right corner, then the plus symbol on the far right of the next row to create a new View</li>
<li>Enter a title of the View, then Save</li>
<li>Click the blue 'Add card', scroll down the list of cards to the bottom and click 'Manual',
delete the template card configuration and copy/paste the following YAML into the dashboard and click 'Save':</li>
</ul>
<pre><code class="language-yaml">type: vertical-stack
title: Predbat 🦇
cards:
  - type: entities
    entities:
      - entity: predbat.status
      - entity: update.predbat_version
      - entity: select.predbat_update
      - entity: select.predbat_mode
      - entity: select.predbat_saverestore
      - entity: switch.predbat_active
  - type: custom:collapsable-cards
    title: 🔀 Control
    defaultOpen: false
    cards:
      - type: custom:collapsable-cards
        title: 🔢 Input Variables
        defaultOpen: false
        cards:
          - type: custom:auto-entities
            card:
              type: entities
            filter:
              include:
                - entity_id: input_number.predbat*
              exclude: []
            unique: true
            sort:
              method: friendly_name
              numeric: false
      - type: custom:collapsable-cards
        title: 🔀 Switches
        defaultOpen: false
        cards:
          - type: custom:auto-entities
            card:
              type: entities
            filter:
              include:
                - entity_id: switch.predbat*
              exclude: []
            unique: true
            sort:
              method: friendly_name
              numeric: false
      - type: custom:collapsable-cards
        title: 🔢 Selectors
        defaultOpen: false
        cards:
          - type: custom:auto-entities
            card:
              type: entities
            filter:
              include:
                - entity_id: select.predbat*
              exclude: []
            unique: true
            sort:
              method: friendly_name
              numeric: false
  - type: custom:collapsable-cards
    title: '#️⃣ Sensors'
    defaultOpen: false
    cards:
      - type: custom:collapsable-cards
        title: 💷 Cost Sensors
        defaultOpen: false
        cards:
          - type: custom:auto-entities
            card:
              type: entities
            filter:
              include:
                - entity_id: predbat.*cost*
                - entity_id: predbat.*rate*
                - entity_id: predbat.*metric*
              exclude:
                - entity_id: predbat.*start*
                - entity_id: predbat.*end*
                - entity_id: predbat.*duration*
            unique: true
            sort:
              method: friendly_name
              numeric: false
      - type: custom:collapsable-cards
        title: 💷 Saving Sensors
        defaultOpen: false
        cards:
          - type: custom:auto-entities
            card:
              type: entities
            filter:
              include:
                - entity_id: predbat.*saving*
              exclude:
                - entity_id: predbat.*start*
                - entity_id: predbat.*end*
                - entity_id: predbat.*duration*
            unique: true
            sort:
              method: friendly_name
              numeric: false
      - type: custom:collapsable-cards
        title: 🕛 Time/Duration Sensors
        defaultOpen: false
        cards:
          - type: custom:auto-entities
            card:
              type: entities
            filter:
              include:
                - entity_id: predbat.*start*
                - entity_id: predbat.*end*
                - entity_id: predbat.*duration*
                - entity_id: predbat.*record*
              exclude: []
            unique: true
            sort:
              method: friendly_name
              numeric: false
      - type: custom:collapsable-cards
        title: ⚡ Power Sensors
        defaultOpen: false
        cards:
          - type: custom:auto-entities
            card:
              type: entities
            filter:
              include:
                - entity_id: predbat.*soc*
                - entity_id: predbat.*energy*
                - entity_id: predbat.*load*
                - entity_id: predbat.*battery*
                - entity_id: predbat.*kw*
                - entity_id: predbat.*power*
                - entity_id: predbat.*charge*
                - entity_id: predbat.*iboost*
                - entity_id: predbat.*grid*
                - entity_id: sensor.predbat_pv*
              exclude:
                - entity_id: predbat.*savings*
                - entity_id: predbat.*start*
                - entity_id: predbat.*end*
                - entity_id: predbat.*duration*
                - entity_id: predbat.*record*
            unique: true
            sort:
              method: friendly_name
              numeric: false
      - type: custom:collapsable-cards
        title: 1️⃣ Binary Sensors
        defaultOpen: false
        cards:
          - type: custom:auto-entities
            card:
              type: entities
            filter:
              include:
                - entity_id: binary_sensor.predbat*
              exclude: []
            unique: true
            sort:
              method: friendly_name
              numeric: false
</code></pre>
<p>This will give you a compact dynamically created list of all Predbat entities which groups the entities by type and is collapsed by default to prevent screen clutter.</p>
<p><img alt="image" src="../images/output_data_dynamic_dashboard.png" /></p>
<p>Credit @DJBenson for the code.</p>
<h3 id="viewing-the-predbat-plan">Viewing the Predbat plan</h3>
<p>The Predbat Plan card is very useful for seeing the plan that Predbat has created - <a href="../predbat-plan-card/">Create the Predbat Plan card</a>.</p>
<h3 id="graphing-the-predbat-predictions">Graphing the Predbat predictions</h3>
<p>A set of Apex Charts can also be created to see graphically what Predbat plans to do - <a href="../creating-charts/">Creating the charts</a>.</p>
<h2 id="basic-status">Basic status</h2>
<ul>
<li>
<p><strong>switch.predbat_active</strong> - Automatically set by Predbat to On when Predbat is busy calculating or controlling your inverter,
or Off when Predbat is waiting for the next time it needs to perform a plan calculation update.
If you toggle this switch in Home Assistant it will force Predbat to perform an update now (useful for automations).</p>
</li>
<li>
<p><strong>predbat.status</strong> - Gives the current status &amp; errors and logs any changes that Predbat makes to your inverter.
The different Predbat status values and their meanings are detailed in <a href="../what-does-predbat-do/#predbat-status">what does Predbat do</a>.</p>
</li>
</ul>
<p><img alt="image" src="https://github.com/springfall2008/batpred/assets/48591903/e24914b8-93d9-4217-812a-ac25a569a52c" /></p>
<p>predbat.status additionally has the following attributes that are automatically populated:</p>
<ul>
<li><strong>Last updated</strong> - date and time that Predbat last updated the plan</li>
<li><strong>Debug</strong> - A set of arrays containing Predbat's planned charging and discharging time windows and battery limits (in kWh)</li>
<li><strong>Version</strong> - version of Predbat that's running</li>
<li><strong>Error</strong> - binary value true or false depending upon whether Predbat is in an error status or nor</li>
</ul>
<h2 id="baseline-data">Baseline data</h2>
<p>What your battery is expected to do <em>over the forecast_hours duration of the plan</em> with no changes made by Predbat:</p>
<p>NB: Predbat forecasts are from 'now' to the forecast_hours duration (set in apps.yaml) into the future and shouldn't be confused with 'today' figures.
e.g. predbat.pv_energy is the predicted PV energy for today and forecast_hours (typically 48) ahead
so will be much larger than sensor.solcast_pv_forecast_today which is today's Solcast PV forecast.</p>
<ul>
<li>predbat.battery_hours_left - The number of hours left until your home battery is predicted to run out (stops at the maximum prediction time)</li>
<li>predbat.charge_limit - The current charge limit used for the scenario in %</li>
<li>predbat.charge_limit_kw - The current charge limit used for the scenario in kWh</li>
<li>predbat.duration - The duration of the prediction maximum in hours</li>
<li>predbat.load_energy - Predicted load energy in kWh</li>
<li>predbat.pv_energy - Predicted PV energy in kWh</li>
<li>predbat.export_energy - Predicted export energy in kWh</li>
<li>predbat.import_energy - Predicted import energy in kWh</li>
<li>predbat.import_energy_battery - Predicted import energy to charge your home battery in kWh</li>
<li>predbat.import_energy_house - Predicted import energy not provided by your home battery (flat battery or above maximum discharge rate)</li>
<li>predbat.soc_kw - Predicted state of charge (in kWh) at the end of the prediction, not very useful in itself, but holds all
minute by minute prediction data (in attributes) which can be charted with Apex Charts (or similar)</li>
<li>predbat.soc_min_kwh - The minimum battery level during the time period in kWh</li>
<li>predbat.metric - Predicted cost metric for the next simulated period (in pence). Also contains data for charting cost in the entity attributes</li>
<li>predbat.battery_power - Predicted battery power per minute, for charting</li>
<li>predbat.battery_cycle - Predicted battery cycle in kWh (total kWh processed)</li>
<li>predbat.pv_power - Predicted PV power per minute, for charting</li>
<li>predbat.grid_power - Predicted Grid power per minute, for charting</li>
<li>predbat.car_soc - The expected charge level of your car at the end of the plan. Can also be charted</li>
<li>input_number.predbat_iboost_today - Gives the amount of energy modelled that will be sent to the solar diverter today,
increments during the day and is reset to zero at 11:30pm each night</li>
</ul>
<h2 id="pv-10-baseline-data">PV 10% baseline data</h2>
<p>The calculated baseline results under PV 10% scenario for the forecast_hours duration of the plan:</p>
<ul>
<li>predbat.soc_kw_base10 - As soc_kw but using the 10% solar forecast, also holds minute by minute data (in attributes) to be charted</li>
<li>predbat.base10_pv_energy - Predicted PV 10% energy in kWh</li>
<li>predbat.base10_metric - Predicted cost for PV 10%</li>
<li>predbat.base10_export_energy- Predicted export energy for PV 10%</li>
<li>predbat.base10_load_energy - Predicted load energy for PV 10%</li>
<li>predbat.base10_import_energy- Predicted import energy for PV 10%</li>
</ul>
<h2 id="best">Best</h2>
<p>Predbat outputs the following 'best' entities from the forecast (for the forecast_hours duration) based on the lowest cost consumption plan:</p>
<ul>
<li>predbat.best_battery_hours_left - Number of hours left under best plan</li>
<li>predbat.best_export_energy - Predicted exports under best plan</li>
<li>predbat_best_import_energy - Predicted imports under best plan</li>
<li>predbat_best_load - Predicted best load energy</li>
<li>predbat.best_pv_energy - Predicted Best PV energy in kWh</li>
<li>predbat_best_import_energy_battery - Predicted imports to the battery under best SoC setting</li>
<li>predbat_best_import_energy_house - Predicted imports to the house under best SoC setting</li>
<li>predbat_soc_kw_best - Predicted best final state of charge (in kWh), holds minute by minute prediction data (in attributes) to be charted</li>
<li>predbat.soc_kw_best_h1 - Single data point for the predicted state of charge in 1 hours time (useful for calibration charts, predicted vs actual)</li>
<li>predbat.soc_kw_best_h8 - Single data point for the predicted state of charge in 8 hours time (useful for calibration charts, predicted vs actual)</li>
<li>predbat.soc_kw_best_h12 - Single data point for the predicted state of charge in 12 hours time (useful for calibration charts, predicted vs actual)</li>
<li>predbat_best_metric - The predicted cost if the proposed SoC % charge target is selected. Also contains data for charting cost in attributes</li>
<li>predbat.best_charge_limit - Predicted best battery charge limit in percent</li>
<li>predbat.best_charge_limit_kw - Predicted best battery charge limit in kWh</li>
<li>predbat.best_discharge_limit - Predicted best battery discharge limit in percent (will be 0% when discharging or 100% when not)</li>
<li>predbat.best_discharge_limit_kw - Predicted best battery discharge limit in kWh</li>
<li>predbat.battery_power_best  - Predicted best battery power per minute, for charting</li>
<li>predbat.battery_cycle_best - Predicted best battery cycle in kWh (total kWh processed)</li>
<li>predbat.pv_power_best - Predicted best PV power per minute, for charting</li>
<li>predbat.grid_power - Predicted best Grid power per minute, for charting</li>
<li>predbat.car_soc_best - The expected charge level of your car in best plan at the end of the plan using the proposed SoC%/Window. Can also be charted</li>
<li>predbat.iboost_best - Gives the predicted energy going into the iBoost solar diverter</li>
</ul>
<h2 id="best-pv-10">Best PV 10%</h2>
<p>The calculated best results under the PV 10% scenario for the forecast_hours duration:</p>
<ul>
<li>predbat.soc_kw_best10 - As soc_kw_best but using the 10% solar forecast, also holds minute by minute data (in attributes) to be charted</li>
<li>predbat.best10_pv_energy - Predicted best PV 10% energy in kWh</li>
<li>predbat.best10_metric - Predicted best cost for PV 10%</li>
<li>predbat.best10_export_energy- Predicted best export energy for PV 10%</li>
<li>predbat.best10_load_energy - Predicted best load energy for PV 10%</li>
<li>predbat.best10_import_energy- Predicted best import energy for PV 10%</li>
</ul>
<h2 id="battery-status">Battery status</h2>
<p>The following sensors are set based upon what Predbat is currently controlling the battery to do:</p>
<ul>
<li>binary_sensor.predbat_charging - Set to 'on' when Predbat is force charging the battery (from solar, or if that is insufficient, from grid import), or 'off' otherwise</li>
<li>binary_sensor.predbat_discharging - Set to 'on' when Predbat is force discharging the battery for export income, 'off' otherwise.
Useful for automations if for example you want to turn off car charging when the battery is being exported</li>
</ul>
<h2 id="energy-rate-data">Energy rate data</h2>
<h3 id="low-import-rate-entities">Low import rate entities</h3>
<ul>
<li>predbat.low_rate_cost - The lowest import rate cost in Pence</li>
<li>predbat.low_rate_start - Start time of the next low import rate slot</li>
<li>predbat.low_rate_end - End time of the next low import rate slot</li>
<li>predbat.low_rate_cost_2, predbat.low_rate_start_2, predbat.low_rate_end_2 - The following low import rate slot</li>
<li>binary_sensor.predbat_low_rate_slot - A sensor that is 'on' to indicate when there is a low energy rate slot active, 'off' otherwise</li>
</ul>
<h3 id="high-export-rate-entities">High export rate entities</h3>
<ul>
<li>predbat.high_export_rate_cost - The highest export rate cost in Pence</li>
<li>predbat.high_export_rate_start - Start time of the next high export rate slot</li>
<li>predbat.high_export_rate_end - End time of the next high export rate slot</li>
<li>predbat.high_export_rate_cost_2, predbat.high_export_rate_start_2, predbat.high_export_rate_end_2 - The following high export rate slot</li>
<li>binary_sensor.predbat_high_export_rate_slot - A sensor that is 'on' to indicate when there is a high export rate slot active, 'off' otherwise</li>
</ul>
<h3 id="other-rate-entities">Other rate entities</h3>
<ul>
<li>predbat.rates - The current energy rates in Pence (also can be charted)</li>
<li>predbat.rates_export - The current energy export rates in Pence (also can be charted)</li>
<li>predbat.cost_today - The total cost of energy so far today (since midnight)</li>
</ul>
<h2 id="car-data">Car data</h2>
<ul>
<li>binary_sensor.predbat_car_charging_slot - A binary sensor indicating when to charge your car (if car planning is enabled) - which can be used in an automation
as described in <a href="../car-charging/#car-charging-planning">Predbat led car charging</a></li>
<li>predbat.car_charging_start - The time that car charging is planned to start at, in HH:MM:SS format</li>
</ul>
<h2 id="iboost-solar-diverter-data">iBoost Solar Diverter data</h2>
<ul>
<li>binary_sensor.predbat_iboost_active - A binary sensor indicating when there is excess solar and the solar diverter (e.g. iBoost, Eddi or just plain immersion heater) should be active,
can be used for automations to trigger the immersion heater boost</li>
</ul>
<h2 id="energy-saving-data">Energy saving data</h2>
<ul>
<li>predbat.cost_yesterday - A sensor that gives you your energy costs for yesterday (00:00-23:59 on the previous day)</li>
<li>predbat.savings_yesterday_predbat - A sensor which tells you have much money Predbat saved you yesterday compared to not using Predbat and only charging at the lowest
import rate in the 24 hour Period</li>
<li>predbat.savings_total_predbat - A running total of the above</li>
<li>predbat.savings_yesterday_pvbat - A sensor which tells you have much money you saved vs not having a PV and battery system at all (this includes in the Predbat savings)</li>
<li>predbat.savings_total_pvbat - A running total of the above</li>
</ul>
<h2 id="solar-forecast-data">Solar forecast data</h2>
<ul>
<li>sensor.predbat_pv_today - Tracks the PV forecast for today, attributes give the remaining amount today and the half hourly data</li>
<li>sensor.predbat_pv_tomorrow - Tracks the PV forecast for tomorrow, attributes give the remaining amount today and the half hourly data</li>
</ul>
<h2 id="predbat-logfile">Predbat Logfile</h2>
<p>Predbat writes detailed logging, status and progress activity information to a logfile as it runs and so this file should be checked if <strong>predbat.status</strong> reports an error,
or if you want to verify that Predbat is running OK.</p>
<p>There is a lot of output in the logfile, this is normal!</p>
<p>Depending on how you installed Predbat the logfile will be held in one of three different directories in Home Assistant and the filename varies slightly:</p>
<ul>
<li>
<p>if you have used the <a href="../install/#predbat-add-on-install">Predbat add-on installation method</a>, the logfile will be <code>/addon_configs/6adb4f0d_predbat/predbat.log</code>,</p>
</li>
<li>
<p>if the <a href="../install/#appdaemon-predbat-combined-install">combined AppDaemon/Predbat add-on installation method</a> was used, it's <code>/addon_configs/46f69597_appdaemon-predbat/predbat.log</code>,
or</p>
</li>
<li>
<p>with the <a href="../install/#predbat-installation-into-appdaemon">HACS, Appdaemon add-on then Predbat installation method</a>, it's <code>/homeassistant/appdaemon/appdaemon.log</code>.</p>
</li>
</ul>
<p>You will need to use a file editor within Home Assistant (e.g. either the File editor or Studio Code Server add-on's)
to view Predbat's logfile - see <a href="../install/#editing-configuration-files-in-home-assistant">editing configuration files within Home Assistant</a> if you need to install an editor.</p>
<h2 id="automated-monitoring-that-predbat-and-givtcp-are-running-ok">Automated monitoring that Predbat and GivTCP are running OK</h2>
<p>With GivTCP and Predbat performing an important function, managing your battery charging and discharging to best reduce your electricity bills,
you may find these automations useful to monitor that GivTCP and Predbat are running OK, and if not, to raise an alert on your mobile device running the Home Assistant Companion app.</p>
<p>To create a new automation:</p>
<ul>
<li>Settings / Automations &amp; Scenes</li>
<li>Create Automation / Create new Automation</li>
<li>Three dots (top right corner) / Edit in YAML</li>
<li>Delete the existing (template) automation code and copy/paste the supplied automation code below</li>
</ul>
<h3 id="givtcp-activity-monitor">GivTCP activity monitor</h3>
<p>This automation will raise an alert if any of the following occur:</p>
<ul>
<li>The inverter goes offline for more than 15 minutes</li>
<li>No last_updated_time received from the inverter for more than 15 minutes</li>
<li>Inverter temperature less than 5 degrees for more than 15 minutes (should never happen)</li>
<li>The battery goes offline to the inverter for more than 15 minutes</li>
<li>GivTCP add-on is not running</li>
<li>Mosquitto broker add-on is not running</li>
<li>Predbat/AppDaemon-predbat or AppDaemon add-on (as appropriate) is not running</li>
</ul>
<p>The script will need to be customised for your inverter id, battery id and mobile details,
and can be extended for multiple inverters and batteries by duplicating the triggers and adding appropriate battery and inverter id's.</p>
<pre><code class="language-yaml">alias: GivTCP activity monitor
description: Alert when communications to GivTCP have ceased for 15 minutes
trigger:
  - platform: state
    entity_id: sensor.givtcp_&lt;inverter id&gt;_last_updated_time
    to: &quot;null&quot;
    for:
      minutes: 15
    variables:
      alert_text: No GivTCP update received from inverter &lt;id&gt;
      restart_app: GivTCP
  - platform: state
    entity_id:
      - sensor.givtcp_&lt;inverter id&gt;_status
    from: online
    for:
      minutes: 15
    variables:
      alert_text: No GivTCP update received from inverter &lt;id&gt;
      restart_app: GivTCP
  - platform: numeric_state
    entity_id:
      - sensor.givtcp_&lt;inverter id&gt;_invertor_temperature
    for:
      minutes: 15
    below: 10
    variables:
      alert_text: No GivTCP update received from inverter &lt;id&gt;
      restart_app: GivTCP
  - platform: state
    entity_id:
      - sensor.givtcp_&lt;battery id&gt;_battery_cells
    to: unknown
    for:
      minutes: 15
    variables:
      alert_text: Battery &lt;battery_id&gt; is offline to GivTCP
      restart_app: GivTCP
  - platform: state
    entity_id:
      - binary_sensor.givtcp_running
    to: &quot;off&quot;
    for:
      minutes: 15
    variables:
      alert_text: GivTCP add-on is not running
      restart_app: GivTCP
  - platform: state
    entity_id:
      - binary_sensor.mosquitto_broker_running
    to: &quot;off&quot;
    for:
      minutes: 15
    variables:
      alert_text: Mosquitto Broker add-on is not running
      restart_app: Mosquitto
  - platform: state
    entity_id:
      - binary_sensor.&lt;appdaemon&gt;&lt;-predbat&gt;_running
    to: &quot;off&quot;
    for:
      minutes: 15
    variables:
      alert_text: &lt;AppDaemon&gt;&lt;-predbat&gt; add-on is not running
      restart_app: Predbat
action:
  - service: notify.mobile_app_&lt;your mobile device id&gt;
    data:
      title: GivTCP communication issue
      message: |
        {{now().strftime('%-d %b %H:%M')}} ISSUE:
        {{ alert_text }} for the past 15 minutes, restarting
        {{ restart_app }}
      data:
        visibility: public
        persistent: true
        push:
          sound:
            name: default
            critical: 1
            volume: 0.8
          sticky: true
          color: red
  - choose:
      - conditions:
          - condition: template
            value_template: &quot;{{ restart_app == 'GivTCP' }}&quot;
        sequence:
          - alias: Restart GivTCP add-on
            action: hassio.addon_restart
            data:
              addon: 533ea71a_givtcp
      - conditions:
          - condition: template
            value_template: &quot;{{ restart_app == 'Mosquitto' }}&quot;
        sequence:
          - alias: Restart Mosquitto add-on
            action: hassio.addon_restart
            data:
              addon: core_mosquitto
      - conditions:
          - condition: template
            value_template: &quot;{{ restart_app == 'Predbat' }}&quot;
        sequence:
          - alias: Restart Predbat add-on
            action: hassio.addon_restart
            data:
              addon: a06adb4f0d_predbat
mode: single
</code></pre>
<p>The last three triggers (GivTCP, Mosquitto and Predbat/AppDaemon running) trigger if any of these add-ons that Predbat is dependent upon are not running.
You will need to enable a binary sensor for each add-on to be able to use these triggers in the automation:</p>
<ul>
<li>Navigate to Settings / Devices and Services / Devices and search for 'GivTCP'</li>
<li>Click on the GivTCP add-on, and under 'Sensors', click 'XX entities not shown'</li>
<li>Click the 'Running' sensor, then the cogwheel, and Enable the sensor</li>
</ul>
<p>Repeat these steps for the 'Mosquitto' add-on and either 'Predbat', 'AppDaemon' or 'AppDaemon-predbat' depending on which Predbat install option you followed.</p>
<p>As an extension to the above, if you don't want the automation to restart the failing add-on and instead just send an alert that there is a problem, delete the 'choose' code above.
Restarting GivTCP does however lose the current GivTCP log in Home Assistant.</p>
<p>NB: If you are using GivTCP v2 rather than v3, replace the '533ea71a_givtcp' with 'a6a2857d_givtcp';
and if you are using AppDaemon rather than the Predbat add-on, replace '6adb4f0d_predbat' with 'a0d7b954_appdaemon'.</p>
<h3 id="predbat-error-monitor">Predbat error monitor</h3>
<p>This automation will raise an alert if Predbat's status turns to <em>Error</em> for more than 5 minutes.</p>
<p>In normal operation Predbat will automatically run and update its forecast every 5 minutes. If the automation detects that Predbat has not done this for 20 minutes,
then an alert will be raised and the automation will restart the Predbat add-on to try to resolve a 'hung Predbat' issue.</p>
<p>The script will need to be customised for your mobile details.</p>
<pre><code class="language-yaml">alias: Predbat error monitor
description: Alert when Predbat has raised an exception
trigger:
  - platform: template
    alias: Predbat status contains 'Error' for 5 minutes
    value_template: &quot;{{ 'Error' in states('predbat.status') }}&quot;
    for:
      minutes: 5
    variables:
      alert_text: &gt;-
        predbat status is {{ states('predbat.status') }}, error={{
        state_attr('predbat.status', 'error') }}
  - platform: state
    alias: Predbat is in error status for 5 minutes
    entity_id: predbat.status
    attribute: error
    to: &quot;true&quot;
    for:
      minutes: 5
    variables:
      alert_text: &gt;-
        predbat status is {{ states('predbat.status') }}, error={{
        state_attr('predbat.status', 'error') }}
  - platform: state
    alias: Predbat status.last_updated has not changed for 20 minutes
    entity_id: predbat.status
    attribute: last_updated
    for:
      minutes: 20
    variables:
      alert_text: &gt;-
        Predbat stalled? Restarting. last_updated=' {{
        state_attr('predbat.status','last_updated')|as_timestamp|timestamp_custom('%a
        %H:%M') }}', unchanged for 20 mins; Status='{{ states('predbat.status')
        }}'
      restart_predbat: &quot;Y&quot;
action:
  - service: notify.mobile_app_&lt;your mobile device id&gt;
    data:
      title: Predbat status issue
      message: |
        {{now().strftime('%-d %b %H:%M')}} ISSUE:
        {{ alert_text }}
      data:
        visibility: public
        persistent: true
        push:
          sound:
            name: default
            critical: 1
            volume: 0.8
        sticky: true
        color: red
  - if:
      - condition: template
        value_template: &quot;{{ restart_predbat == 'Y' }}&quot;
    then:
      - action: hassio.addon_restart
        data:
          addon: 6adb4f0d_predbat
        alias: Restart Predbat add-on
mode: single
</code></pre>
<p>NB: If you are using AppDaemon rather than the Predbat add-on, replace '6adb4f0d_predbat' with 'a0d7b954_appdaemon'.</p>
<p>An error alert looks like this:</p>
<p><img alt="image" src="../images/predbat-status-issue.png" /></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../manual-api/" class="btn btn-neutral float-left" title="Predbat automation API"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../predbat-plan-card/" class="btn btn-neutral float-right" title="Predbat Plan card">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../manual-api/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../predbat-plan-card/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
